<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CityRide — Your Go-to Car Rental Service!</title>
    <link rel="stylesheet" href="reviewstyle.css">
</head>
<body>
    <div class="navbar">
        <img class="logopic" src="images/rentallogo.png"><span class="logo">CityRide</span><span class="logocapt">Your Go-To Rental Service</span>
        <div class="barbtns">
            <div class="navbtn"><a class="the" href="Landing.html">Homepage</a></div>
            <div class="navbtn"><a class="the" href="AboutUs.html">About Us</a></div>
            <div class="navbtn"><a class="the" href="Catalogue.html">Vehicles</a></div>
            <div class="navbtn"><a class="the active" href="Reviews.html">Reviews</a></div>
        </div>     
        <div class="accnt">
            <div class="login"><a href="CityRideProject/auth/login.php">Log In / Sign Up</a></div>
            <div class="login"><img class="pfp" src="images/emptypfp.png"></div>
        </div>
    </div>
        <div class="reviewtop">
            <div class="tp">
                <span class="heading">What Our Users Think</span>
                <span class="totalstars">4.3</span><span class="contd">out of<br>5.0 stars<br><span class="total">(7 total reviews)</span></span>
            </div>
            <div class="btm">
                <div class="review one">
                    <span class="reviewpara">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span>
                    <div class="ratingstars"> 
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                    </div>
                </div>
                <div class="review two">
                    <span class="reviewhead">Great accessibility!</span>                    
                    <span class="reviewpara">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span>
                    <div class="ratingstars"> 
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                    </div>
                </div>
                <div class="review three">                    
                    <span class="reviewpara">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</span>
                    <div class="ratingstars"> 
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                        <span class="topstar">&#9734;</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="reviewmiddle">
            <span class="ask">Let us know what you think!</span>
            <div class="reviewstars" data-user-review="1" data-average-rating="4.3">
                <span class="star" data-value="1">&#9734;</span>
                <span class="star" data-value="2">&#9734;</span>
                <span class="star" data-value="3">&#9734;</span>
                <span class="star" data-value="4">&#9734;</span>
                <span class="star" data-value="5">&#9734;</span>
            </div>
            <input class="usertext" type="text" name="usertext" id="usertext">
        </div>
        <div class="reviewbottom">

        </div>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            const reviewStars = document.querySelectorAll('.reviewstars');
            const storageKey = 'userReviews' /* stores ratings in local storage & only allows a user to review once */

            /* to fill stars based on average total. container argument is the amount of stars given, rating is the average value */
            function totalStars(container, rating){
                const stars = document.querySelectorAll('.star');
                const roundedRating = Math.round(rating); /* rounds to the nearest whole, since stars can only be filled entirely */
                stars.forEach((star, index) => {
                    /* works like a for loop in python; goes through each star in this case */
                    /* if statement below ensures that the right amount of stars is filled. if this if statement isn't used, the stars will always fill as 5.0, even after the rounding, no matter what */
                    if (index < roundedRating) {
                        star.classList.add('filled'); /* filled class in css turns star yellow — this function adds the class if the star is filled */
                        star.innerHTML = '&#9733'; 
                    } else {
                        star.classList.remove('filled'); /* removes filled class if star is not checked */
                        star.innerHTML = '&#9734';
                    }
                }); 

            }

            const finishedRatings = JSON.parse(localStorage.getItem(storageKey)) || {}; /* checks local storage for any saved ratings with storageKey. 
            it becomes empty object {} if there are no saved variables in the local storage */

            for(let container of reviewStars){
                const userReview = container.dataset.userReview;
                const rating = container.dataset.userReview;
                let averageRating = parseFloat(container.dataset.averageRating) || 0; /* default is 0 if there is no average rating */
                
                /* fills stars when page loads */
                totalStars(container, averageRating);
                if (!container.classList.contains('rated')) {
                    const stars = container.querySelectorAll('.star')
                    for(let star of stars){
                        star.addEventListener('click', function() { /* click is placed inside the if statement to make sure it can only be done with 'rated' is NOT added as a class */
                            const value = parseInt(this.dataset.value); /* get value of star that was clicked */

                            totalStars(container, value);

                            finishedRatings[rating] = value;
                            localStorage.setItem(storageKey, JSON.stringify(finishedRatings));

                            container.classList.add('rated'); /* disables after user rates */

                            /* to send the user's rating to the server */
                            fetch('rate.php', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    userReview: userReview,
                                    rating: value
                                })
                            })

                            .then(response => response.json()) /* fetches response from rate.php */
                            .then(data => {
                                console.log('Server response:', data); /* fetches data to convert into js object */
                            })
                        });
                    }
                }

            }
        });
</script>
</body>
</html>